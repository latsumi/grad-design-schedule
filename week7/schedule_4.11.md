### 今日目标

确认中期检查失败的原因以及还需要做什么。看完rvbook第十章。尽量看完两份实验指导书的第四章。

### 今日流水账

墨迹到下午两点才坐在实验室桌子前。没关系。

巨困，基本一直在睡觉


### rvbook第十章 RV64特权级机制 

机器模式最重要的特性是拦截和处理异常的能力

10.3介绍了八个重要的控制状态寄存器(`CSR`)，包括 `mscratch` 和 `mstatus` 等等

虽然不知道怎么用，但是暂且记下来的内容：
为避免覆盖整数寄存器中的内容，中断处理程序先在最开始用 mscratch 和整数寄存器(例如 a0)中的值交换。通常，软件会让 mscratch 包含指向附加临时内存空间的指针，处理程序用该指针来保存其主体中将会用到的整数寄存器。在主体执行之后，中断程序会恢复它保存到内存中的寄存器，然后再次使用 mscratch 和 a0 交换， 将两个寄存器恢复到它们在发生异常之前的值。最后，处理程序用 mret 指令(M 模 式特有的指令)返回。mret 将 PC 设置为 mepc，通过将 mstatus 的 MPIE 域复制到 MIE 来恢复之前的中断使能设置，并将权限模式设置为 mstatus 的 MPP 域中的值。

10.4 特权级隔离：物理内存保护功能(PMP，Physical Memory Protection)，低特权级的时候试图运行L或者S指令时，会跟pmp的寄存器比较

监管者模式(S 模式)的核心：使用基于 页面的虚拟内存

riscv 的 异常委托机制，将中断和异常处理交给s模式 

mideleg寄存器负责委托处理中断，medeleg CSR 将同步异常委托给 S 模式

S模式有几个异常处理 CSR:sepc、stvec、scause、sscratch、stval 和 sstatus，功能同m模式的几个寄存器，但是只作用于s模式

Sv39页表项

satp(Supervisor Address Translation and Protection，监管者地址转换和保护)，是s模式的csr，控制了页表系统。

机器和监管者自陷向量(trap-vector)基地址寄存器(mtvec 和 stvec)CSR，用于保存自陷向量的配置，包括向量基址(BASE)和向量模式(MODE)


### 今日总结

确定了不必再次进行中期检查。但应该会接到黄牌警告，最终要参加系里的抽查答辩。没关系，反而是一个督促。赶紧继续推进进度为好，论文也要着手去做。


