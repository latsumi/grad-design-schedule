### 今日目标
了解要做什么，对这一部分的内容有一定的了解，四天的计划合适吗？

### 可能的学习内容

看吴一凡的gitbook

看下xv6的完成轨迹

newlib：REDHAT专门为嵌入式系统的开发的C库

### 需要完成的工作

主要是耐心阅读别人的学习记录和熟悉newlib提供了哪些可用的函数

记录一凡的步骤：

1. `移除标准库依赖` 包括移除println! 宏，提供语义项 panic_handler，移除 main 函数，分析编译完成的二进制代码程序

2. 找到`编译器要找的入口函数`，构建用户态执行环境（完成这一步就可以打印字符串了）

3. 构建裸机运行时执行环境。QEMU的初始化过程，这部分应该要仔细阅读。SBI调用是什么？

### newlib的介绍

```
newlib是一个面向嵌入式系统的C运行库。相对于glibc，newlib实现了大部分的功能函数，但体积却小很多。newlib独特的体系结构将功能实现与具体的操作系统分层，使之能够很好地进行配置以满足嵌入式系统的要求。由于专为嵌入式系统设计，newlib具有可移植性强、轻量级、速度快、功能完备等特点，已广泛应用于各种嵌入式系统中。

由于嵌入式操作系统和底层硬件的多样性，为了能够将C/C++语言所需要的库函数实现与具体的操作系统和底层硬件进行分层，newlib的所有库函数都建立在20个桩函数的基础上，这20个桩函数完成具体操作系统和底层硬件相关的功能：

1. I/O和文件系统访问（open、close、read、write、lseek、stat、fstat、fcntl、link、unlink、rename）
2. 扩大内存堆的需求（sbrk）
3. 获得当前系统的日期和时间（gettimeofday、times）
4. 各种类型的任务管理函数（execve、fork、getpid、kill、wait、_exit）

这20个桩函数在语义、语法上与POSIX（Portable Operating System Interface of UNIX）标准下对应的20个同名系统调用完全兼容。

所以，如果需要移植newlib至某个目标嵌入式平台，成功移植的关键是在目标平台下找到能够与newlib桩函数衔接的功能函数或者实现这些桩函数。
```

* 所以这个c运行库的哪些是可以直接调用的，哪些是需要我完成的？越看越迷惑了
* 桩函数似乎是需要自己实现的？

### 一日流水账

10：30 - 11：30 看知乎上别人的os开发记录，好像没有太多可以参考的内容

14：00 - 17：00 研究newlib可用吗，够用吗，是否超过需求（指具有本该我来写的内容） 

19：00 - 越看越头晕，先总结一凡干了啥吧

### 零散的可能用到的知识

`strace`：查看程序所用到的系统调用

`riscv-newlib`：可能以后要参考的newlib实现仓库

新的概念：`POSIX标准`？函数需要遵守？

`《30天自制操作系统》`这本书好像有些可取之处

`qemu-riscv64` 和 `qemu-system-riscv64` 的区别：前一个可运行二进制文件程序，而后一个需要将程序下载到客户端操作系统能访问到的硬盘里才能运行（不是很理解，总之优先前面的吧）

### 今日总结

今天花了很多时间在研究newlib有什么，要怎么用上了。大概知道了要想打印字符，得自己实现桩函数。可是这不是在编译器里面的东西吗？和我的代码似乎没有关系，是不是走错方向了。

今天没有达到预想的进度，明天需要先放弃newlib这条线，尝试先看看xv6开始做了什么，再新建一个c项目进行实际的测试操作。
